default:
  context:
    lang: 'en'
    visitor: 'ant'
    node: 'status'
  src: "simple text"
  tem: "simple text"
  res: "simple text"

nasty_erb:
  src: "this <% puts \"could be\" %> nasty"
  tem: "this &lt;% puts \"could be\" %&gt; nasty"

never_end_erb:
  src: "never ending erb  <%= puts "
  tem: "never ending erb  &lt;%= puts "
  res: "never ending erb  &lt;%= puts "

nasty_evil_erb:
  src: "this <% puts <% puts 'could be' %> %> nasty"
  tem: "this &lt;% puts &lt;% puts 'could be' %&gt; %&gt; nasty"

trick_erb:
  src: "this <<r:void/>% puts 'is bad' %>"
  tem: "this <<r:void/>% puts 'is bad' %&gt;"
  res: "this <<r:void/>% puts 'is bad' %&gt;"

include_erb:
  src: "include: <r:include template='/nasty_erb'/>"
  tem: "include: this &lt;% puts \"could be\" %&gt; nasty"

cache_part:
  src: "<r:cache><r:show attr='name'/></r:cache>"
  tem: "<% cache1 = Cache.with(visitor.id, visitor.group_ids, \"NP\", \"en\", \"/cache/part/list1\") do capture do %><%= @node.name %><% end; end %><%= cache1 %>"

show_title:
  src: "<r:show attr='v_title'/>"
  tem: "<%= @node.version.title %>"
  res: "status title"

show_title_with_opts:
  src: "<h1 do='title' class='s70' status='true' actions='all'>this is the title</h1>"
  tem: "/<h1 class='s<%= @node.version.status %>'><%= show_title\(:node=>@node\) \+ node_actions\(:node=>@node, .*:actions=>\"all\"/"
  res: "/<h1 class='s50'><span id=.*class='actions'>/"

title_text:
  src: "<h1 do='title' text='hello world'>this is the title</h1>"
  res: "<h1><span id='v_title22'>hello world</span></h1>"

show_title_check_lang:
  context:
    node: 'cleanWater'
    lang: 'fr'
  src: "<r:title/> AND NOW <r:title check_lang='false'/>"
  res: "<span id='v_title21'>Clean Water project<span class='wrong_lang'>[en]</span></span> AND NOW <span id='v_title21'>Clean Water project</span>"

show_title_link_http:
  src: "<r:title link='http://example.com'/>"
  res: "<a href='http://example.com'><span id='v_title22'>status title</span></a>"

show_title_link_attribute:
  src: "<r:title link='http://[name].com'/>"
  res: "<a href='http://status.com'><span id='v_title22'>status title</span></a>"

show_title_link_id:
  src: "<r:title link='32'/>"
  res: "<a href='/oo/page32.html'><span id='v_title22'>status title</span></a>"

show_title_link_id_from_stored:
  src: "<r:parent><r:title link='[main.id]'/></r:parent>"
  res: "<a href='/oo/projects/cleanWater/page22.html'><span id='v_title21'>Clean Water project</span></a>"

show_title_link_id_from_stored_mode_and_format:
  src: "<r:parent><r:title link='[main.id]_blog.rss'/></r:parent>"
  res: "<a href='/oo/projects/cleanWater/page22_blog.rss'><span id='v_title21'>Clean Water project</span></a>"

show_format:
  src: "<b do='[id]' format='%.2f'/>"
  res: "<b>22.00</b>"

show_format_nil:
  src: "<b do='[d_id]' format='%.2f'/>"
  res: "<b>0.00</b>"

show_format_hide_zero:
  src: "<b do='[d_id]' format='%.2f' zero='hide'/>"
  res: "<b></b>"

show_edit_preview:
  context:
    node: 'status'
  src: "<b do='[d_assigned]' edit_preview='true'/>"
  res: "<b id='d_assigned22'>gaspard</b>"

show_param:
  context:
    d: 'hello ladies'
  src: "<i do='show' param='d'/>"
  tem: "<i><%= params[:d] %></i>"
  res: "<i>hello ladies</i>"

title_in_version_context:
  src: "<r:version><r:title actions='all'/></r:version>"
  res: "/s50.*v_title22.*status title.*edit/"

check_lang:
  context:
    lang: 'fr'
    node: 'people'
  src: "<r:check_lang/> <r:check_lang text='(#LANG)'/> <p class='bad_lang' do='check_lang'>article en '_LANG'</p>"
  res: "<span class='wrong_lang'>[en]</span> <span class='wrong_lang'>(en)</span> <p class='bad_lang'>article en 'anglais'</p>"

show_shortcut:
  src: "<p do='[v_title]'>hello</p>"
  tem: "<p><%= @node.version.title %></p>"
  res: "<p>status title</p>"

zazen_shortcut:
  src: "<div class='foo' do='{v_title}'>hello</div>"
  tem: "<div class='zazen foo'><%= zazen(@node.version.title, :node=>@node) %></div>"
  res: "<div class='zazen foo'><p>status title</p></div>"

show_url:
  src: "<a do='void' set_href='[url]'>blah</a>"
  res: "<a href='http://test.host/oo/projects/cleanWater/page22.html'>blah</a>"

show_url_in_script:
  src: "<script type='text/javascript'>
  digg_url = '<r:show attr='url'/>';
  </script>"
  res: "/http://test.host/oo/projects/cleanWater/page22.html/"

show_path:
  src: "<a do='void' set_href='[path]'>blah</a>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>blah</a>"

show_dyn_attribute:
  src: "<r:show attr='d_assigned'/>"
  tem: "<%= @node.version.dyn[\"assigned\"] %>"
  res: "gaspard"

trans:
  context:
    lang: 'fr'
  src: "<r:trans>Monday</r:trans> <r:trans text='Monday'/>"
  tem: "lundi lundi"
  res: "lundi lundi"

trans_show:
  context:
    lang: 'fr'
  src: "<r:trans><r:show attr='ref_lang'/></r:trans>"
  tem: "<%= _(@node.ref_lang) %>"
  res: "anglais"

trans_attr:
  context:
    lang: 'en'
  src: "<r:trans attr='ref_lang'/>"
  tem: "<%= _(@node.ref_lang) %>"
  res: "english"

show_tattr:
  src: "<r:show tattr='ref_lang'/>"
  tem: "<%= _(@node.ref_lang) %>"
  res: "english"

show_gsub:
  context:
    node: 'tiger'
  src: "<r:show attr='c_address' gsub='/\\n/;/'/>"
  tem: "<%= @node.version.safe_content_read(\"address\").to_s.gsub(/\\n/,\";\") %>"
  res: "Small Island;In the Wild"

show_gsub_newline:
  context:
    node: 'tiger'
  src: "<r:show attr='c_address' gsub='/\\n/\\\\n/'/>"
  res: 'Small Island\nIn the Wild'

show_mean_gsub:
  context:
    node: 'tiger'
  src: "<r:show attr='c_address' gsub=\"/#{puts 'I AM MEAN'}/;/\"/>"
  tem: "<span class='parser_error'>[show] invalid gsub \"/\#{puts 'I AM MEAN'}/;/\"</span>"
  res: "<span class='parser_error'>[show] invalid gsub \"/\#{puts 'I AM MEAN'}/;/\"</span>"

show_attr_actions:
  context:
    visitor: 'lion'
  src: "<h2 do='[v_title]' actions='all'/>"
  res: "/<h2><span class='actions'>.*edit.*drive.*status title<\/h2>/"

link:
  src: "<r:link/>"
  tem: "<a href='<%= zen_path(@node) %>'><%= @node.version.title %></a>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>status title</a>"

zafu_link:
  src: "<li class='super' do='link'>sample text</li>"
  res: "<li class='super'><a href='/oo/projects/cleanWater/page22.html'>status title</a></li>"

zafu_link_t:
  src: "<li class='super' do='link' do='t'>blah</li>"
  res: "<li class='super'><a href='/oo/projects/cleanWater/page22.html'>blah</a></li>"

a_link:
  src: "<a class='bob' do='link'>sample text</a> <a id='bar' do='link' do='t'>click here</a>"
  res: "<a class='bob' href='/oo/projects/cleanWater/page22.html'>status title</a> <a id='bar' href='/oo/projects/cleanWater/page22.html'>click here</a>"

zafu_link_with_blocks:
  src: "<a id='branding' do='link'><img src='sample.png' do='img' src='30'/></a>"
  res: "/<a id='branding' href='/oo/projects/cleanWater/page22.html'><img.*<\/a>/"

link_class:
  src: "<r:link class='hello'/>"
  res: "<a class='hello' href='/oo/projects/cleanWater/page22.html'>status title</a>"

link_set_class:
  src: "<r:link set_class='[name]_foo'/>"
  tem: "<a class='<%= @node.name %>_foo' href='<%= zen_path(@node) %>'><%= @node.version.title %></a>"
  res: "<a class='status_foo' href='/oo/projects/cleanWater/page22.html'>status title</a>"

link_attr:
  src: "<r:link attr='ref_lang'/>"
  tem: "<a href='<%= zen_path(@node) %>'><%= @node.ref_lang %></a>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>en</a>"

link_tattr:
  src: "<r:link tattr='ref_lang'/>"
  tem: "<a href='<%= zen_path(@node) %>'><%= _(@node.ref_lang) %></a>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>english</a>"

link_trans:
  context:
    lang: 'fr'
  src: "<r:link trans='Monday'/>"
  tem: "<a href='<%= zen_path(@node) %>'>lundi</a>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>lundi</a>"

link_parent:
  src: "<r:link href='parent' text='click here'/>"
  tem: "<a href='<%= zen_path(@node.parent) %>'>click here</a>"
  res: "<a href='/oo/projects/cleanWater'>click here</a>"

link_with_block:
  src: "<r:link href='parent'>look at <b do='[name]'>her</b></r:link>"
  tem: "<a href='<%= zen_path(@node.parent) %>'>look at <b><%= @node.name %></b></a>"
  res: "<a href='/oo/projects/cleanWater'>look at <b>status</b></a>"

link_project:
  context:
    node: 'bird_jpg'
  src: "<r:link href='project'/>"
  tem: "<a href='<%= zen_path(@node.project) %>'><%= @node.version.title %></a>"
  res: "<a href='/oo/project29.html'>bird</a>"

link_root:
  src: "<r:link href='root'/>"
  tem: "<a href='<%= zen_path((secure(Node) { Node.find(_ID(zena))})) %>'><%= @node.version.title %></a>"
  res: "<a href='/oo'>status title</a>"

link_anchor:
  src: "<r:link anchor='true'/>"
  res: "<a href='#node22'>status title</a>"

link_anchor_name:
  src: "<r:link anchor='[name]'/>"
  res: "<a href='#status'>status title</a>"

link_anchor_in:
  src: "<r:link anchor='true' in='project' mode='tree'/>"
  res: "<a href='/oo/projects/cleanWater_tree#node22'>status title</a>"

link_anchor_name_in:
  src: "<r:link anchor='[name]' in='parent'/>"
  res: "<a href='/oo/projects/cleanWater#status'>status title</a>"

link_stored:
  src: "<r:void store='foo'><r:parent><r:link href='foo' do='[name]'/></r:parent></r:void>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>cleanWater</a>"

link_date:
  context:
    ref_date: '2008-06-27'
  src: "<r:link date='current_date'/>"
  tem: "/:date=>main_date/"
  res: "<a href='/oo/projects/cleanWater/page22.html?date=2008-06-27'>status title</a>"

link_url_params:
  src: "<r:link plob='hopla'/>"
  res: "<a href='/oo/projects/cleanWater/page22.html?plob=hopla'>status title</a>"

link_url_params_parsed_values:
  src: "<r:link plob='haha [name]'/>"
  res: "<a href='/oo/projects/cleanWater/page22.html?plob=haha+status'>status title</a>"

anchor:
  src: "<r:anchor/> <p do='[id]' anchor='[name]'>hello</p>"
  res: "<a name='node22'></a><a name='status'></a> <p>22</p>"

anchor_in_link:
  src: "<r:anchor do='link'/>"
  res: "<a name='node22' href='/oo/projects/cleanWater/page22.html'>status title</a>"

show_title_anchor:
  src: "<r:title anchor='true'/>"
  res: "<a name='node22'></a><span id='v_title22'>status title</span>"

show_attr_anchor:
  src: "<r:show attr='name' anchor='true'/>"
  res: "<a name='node22'></a>status"

link_version:
  context:
    node: 'opening'
  src: "<r:traductions><r:each join=', '><r:link tattr='lang' /></r:each></r:traductions>"
  res: "<a href='/oo/projects/cleanWater/post27.html?lang=en'>english</a>, <a href='/oo/projects/cleanWater/post27.html?lang=fr'>french</a>"

version_anchor:
  context:
    node: 'opening'
  src: "<r:traductions><r:each join=', '><r:anchor do='link' tattr='lang'/></r:each></r:traductions>"
  res: "<a name='version27.2' href='/oo/projects/cleanWater/post27.html?lang=en'>english</a>, <a name='version27.1' href='/oo/projects/cleanWater/post27.html?lang=fr'>french</a>"

title:
  src: "<h2 do='title'/>"
  tem: "<h2><%= show_title(:node=>@node)%></h2>"
  res: "<h2><span id='v_title22'>status title</span></h2>"

title_link:
  src: "<h2 do='title' link='details'/>"
  tem: "<h2><%= show_title(:node=>@node, :link=>\"details\")%></h2>"
  res: "<h2><a href='/oo/projects/cleanWater/page22_details.html'><span id='v_title22'>status title</span></a></h2>"

title_link_format:
  src: "<h2 do='title' link='details.xml'/>"
  tem: "<h2><%= show_title(:node=>@node, :link=>\"details.xml\")%></h2>"
  res: "<h2><a href='/oo/projects/cleanWater/page22_details.xml'><span id='v_title22'>status title</span></a></h2>"

title_link_data:
  context:
    node: 'bird_jpg'
  src: "<h2 do='title' link='data' attr='v_title'>super titre</h2>"
  res: "<h2><a href='/en/image30.jpg?1144713600'><span id='v_title30'>bird</span></a></h2>"

title_link_data_mode:
  context:
    node: 'bird_jpg'
  src: "<h2 do='title' link='pv.data'>super title</h2>"
  res: "<h2><a href='/en/image30_pv.jpg?967816914293'><span id='v_title30'>bird</span></a></h2>"

show_parent_title:
  src: "<r:parent><h1 do='title' attr='v_title'>parent title</h1></r:parent>"
  tem: "<% if var1 = @node.parent -%><h1><%= show_title(:node=>var1, :text=>var1.version.title)%></h1><% end -%>"
  res: "<h1><a href='/oo/projects/cleanWater'><span id='v_title21'>Clean Water project</span></a></h1>"

show_bad_attr:
  src: "my <r:show attr=':name'/>, <r:show attr='puts'/>"
  tem: 'my <%= @node.safe_read(":name") %>, <%= @node.safe_read("puts") %>'
  res: "my ':name' not readable, 'puts' not readable"

show_name:
  src: "my <r:show attr='name'/>"
  res: "my status"

show_v_text:
  src: "my <r:show attr='v_text'/>"
  res: "my status text"

show_title_options:
  src: "<h1 class='title' do='title' status='true' actions='edit,publish'/>"
  tem: "/node_actions\(:node=>@node, .*:actions=>\"edit,publish\"/"
  res: "/<h1 class='s50 title'><span id='v_title22'>status title</span><span class='actions'><a.*/nodes/22/versions/0/edit.*/images/page_edit.png'.*/></a>.*</span></h1>/"

show_c_width:
  context:
    node: "bird_jpg"
  src: "width = <r:show attr='c_width'/>"
  res: "width = 660"

show_else:
  src: "[<r:show attr='v_title' else='name'/>, <r:show attr='d_foo' else='name'/>]"
  res: "[status title, status]"

show_default:
  src: "[<r:show attr='name' default='baz'/>, <r:show attr='d_foo' default='baz'/>]"
  res: "[status, baz]"

show_else_default:
  src: "[<r:show attr='v_title' else='name' default='baz'/>, <r:show attr='d_foo' else='name' default='baz'/>, <r:show attr='d_foo' else='d_bar' default='baz'/>]"
  res: "[status title, status, baz]"



javascripts:
  src: "<r:javascripts list='prototype,effects,zena'/>"
  tem: "/<script src.*/javascripts/prototype.js.*script src=.*effects.js.*zena.js/"

stylesheets:
  src: "<r:stylesheets list='zena,code,search'/>"
  tem: "/link href.*/stylesheets/zena.css.*text/css.*code.css.*text/css.*search.css.*stylesheet/"

lang_links:
  src: "<div id='lang' do='lang_links'><a>en</a> | <b>fr</b></div>"
  tem: "<div id='lang'><%= lang_links(:node=>@node) %></div>"
  res: "/<div id='lang'><em>en.*test_render.*=fr/"

lang_links_options:
  src: "<div id='lang' do='lang_links' join=' | ' wrap='p'><a>en</a> | <b>fr</b></div>"
  res: "/<div id='lang'><p class='on'>en.*\|.*test_render.*=fr/"

show_path:
  src: "<ul id='path' do='show_path'><ul><li><a href='#'>first</a></li> / <li><a href='#'>second</a></li> / <li><a href='#' class='current'>here</a></li></ul></div>"
  tem: "<ul id='path'><%= show_path(:node=>@node) %></ul>"
  res: "/<ul id='path'><li>.*zena.*<li>.*oo/page18.html.*<li><.*/projects/cleanWater.*cleanWater</a>.*/oo/projects/cleanWater/page22.html.*class='current'>status</a>/"

show_path_options:
  src: "<div id='path' do='show_path' wrap='p'/>"
  res: "/<div id='path'><p>.*zena.*<p>.*oo/page18.html.*<p><.*/projects/cleanWater.*cleanWater</a>.*/oo/projects/cleanWater/page22.html.*class='current'>status</a>/"

uses_datebox:
  src: "<r:uses_datebox/>"
  tem: "/<script.*calendar.js.*calendar-setup.js.*calendar-en-utf8.js.*calendar-brown.css.*DEF_DATE_FORMAT.*%Y-%m-%d %H:%M.*FIRST_DAY.*0/"

calendar:
  context:
    ref_date: "2006-03-18"
  src: "<div do='calendar' select='notes in site'/>"
  res: "/<td class='sat ref'><span>18</span><ul><li><a href='/oo/projects/cleanWater/post27.html'>opening</a></li></ul><\/td>/"

calendar_default_else:
  context:
    # no notes here
    ref_date: "2008-01-30"
  src: "<div do='calendar'>---</div>"
  res: "/<td class='sun'>27<\/td>/"

calendar_l_date:
  context:
    ref_date: "2009-7-17"
    node: 'zena'
  src: "<div do='calendar' select='added_notes' date='l_date' />"
  res: "/<td class='ref'><span>17</span><ul><li><a href='/oo/projects/cleanWater/post27.html'>opening</a></li></ul></td>/"

calendar_hours:
  context:
    ref_date: "2009-7-17"
    node: 'zena'
  # I do not like the way we do this, the 'else' thing is not helping. Maybe we need some
  # extra zafu tags because it' messy: we have 3 lists (days, hours, nodes) ...
  src: "<div do='calendar' select='added_notes' date='l_date' split_hours='12'><r:if test='hour eq 0' do='[current_date]' format='%d'/><div do='void' set_class='hour_[hour]' do='each' do='[name]' join=', '/><r:else><r:if test='hour eq 0' do='[current_date]' format='%d'/><div do='void' set_class='hour_[hour]'></div></r:else></div>"
  res: "/<td class='ref'>17<div class='hour_0'></div><div class='hour_12'>opening</div></td>/"

flash_messages_both:
  src: "<r:flash_messages/>"
  tem: "/id.*messages.*notice.*flash.*notice.*error.*flash.*error/"
  res: "<div id='messages'></div>"

flash_messages_error:
  src: "<r:flash_messages show='error'/>"
  tem: "/id.*messages.*error.*flash.*error/"
  res: "<div id='messages'></div>"

flash_messages_notice:
  src: "<r:flash_messages show='notice'/>"
  tem: "/id.*messages.*notice.*flash.*notice/"
  res: "<div id='messages'></div>"

show_author_short:
  src: "<div class='subtitle' do='show_author'><b>SI</b> - 05.12</div>"
  tem: "<div class='subtitle'><b><%= @node.version.author.initials %></b> - <%= format_date(@node.version.updated_at, \"%m.%d\") %></div>"
  res: "<div class='subtitle'><b>SI</b> - 04.11</div>"

show_author_large:
  src: "<r:show_author size='large'/>"
  tem: "/posted by.*@node.author.fullname.*traduction by.*@node.version.author.fullname.*else.*modified by.*@node.version.author.fullname.*on.*@node.version.updated_at, \"%m.%d\"/"
  res: "posted by <b>Solenopsis Invicta</b> on 04.11."

each_traductions:
  src: "<r:traductions except='current'><ul><li do='each'><r:show attr='title'/></li></ul></r:traductions>"
  tem: "<% if list1 = @node.traductions(:conditions=>\"lang != 'en'\") -%><ul><% list1.each do |var1| -%><li><%= var1.title %></li><% end -%></ul><% end -%>"
  res: "<ul><li>Etat des travaux</li></ul>"

each_traductions_except_list:
  src: "<r:traductions except='en,ru'><ul><li do='each'><r:show attr='title'/></li></ul></r:traductions>"
  res: "<ul><li>Etat des travaux</li></ul>"

each_traductions_only_list:
  src: "<r:traductions only='en,ru'><ul><li do='each'><r:show attr='title'/></li></ul></r:traductions>"
  res: "<ul><li>status title</li></ul>"

each_alternate_class:
  context:
    node: 'cleanWater'
  src: "<ol do='pages'><li do='each' alt_class='blue' do='[name]'/></ol>"
  res: "<ol><li>crocodiles</li><li class=\"blue\">status</li><li>track</li></ol>"

each_alternate_class_reverse:
  context:
    node: 'cleanWater'
  src: "<ol do='pages' limit='2'><li do='each' alt_class='blue' alt_reverse='true' do='[name]'/></ol>"
  res: "<ol><li class=\"blue\">crocodiles</li><li>status</li></ol>"

each_alternate_class_two:
  context:
    node: 'collections'
  src: "<ol do='pages'><li class='post' alt_class='stripe' do='each' do='[name]'/></ol>"
  res: "<ol><li class='post'>art</li><li class='post stripe'>menu</li><li class='post'>news</li><li class='post stripe'>wikiSkin</li></ol>"

each_alternate_class_ajax:
  context:
    node: 'cleanWater'
  src: "<ol do='pages' limit='2'><li do='each' alt_class='blue' do='[name]'/><li do='add'/></ol>"
  res: "/<li>crocodiles<\/li><li class=\"blue\">status/"

each_else:
  context:
    node: 'opening'
  src: "<div do='pages'>has pages (<r:each do='[name]' join=', '/>)<r:else>no pages</r:else></div>"
  tem: "/-%><div>has pages \(<% list1.each do \|var1\| -%><%= var1.name %><% end -%>\)</div><% elsif true -%><div>no pages</div><% end -%>/"
  res: "<div>no pages</div>"

case_when:
  src: "<r:case><r:when kind_of='Document'>this is a document</r:when><r:when klass='Page'>Page</r:when><r:when status='pub'>Pub</r:when>"
  tem: "<% if false -%><% elsif @node.vkind_of?(\"Document\") -%>this is a document<% elsif @node.klass == \"Page\" -%>Page<% elsif @node.version.status == 50 -%>Pub<% end -%>"
  res: "Page"

case_when_else:
  src: "<r:case><r:when kind_of='Document'>Document</r:when><r:else>Not a document</r:else></r:case>"
  res: "Not a document"

case_when_else_text:
  src: "<r:case><r:when kind_of='Document'>Document</r:when><r:else text='Not a document'/></r:case>"
  res: "Not a document"

case_when_test:
  src: "<r:case><r:when test='id gt 10'>one</r:when><r:when test='v_updated_at gt updated_at'>two</r:when></r:case>"
  res: "one"

if_html_tag:
  src: "<div do='if' test='1 eq 1'>yes it's true<r:else>four</r:else></div>"
  res: "<div>yes it's true</div>"

case_when_html_tag:
  src: "<div do='case'><r:when test='1 eq 3'>one</r:when><r:when test='1 eq 1'>two</r:when><r:else>four</r:else></div>"
  res: "<div>two</div>"

case_when_html_tag_else:
  src: "<div do='case'><r:when test='1 eq 3'>one</r:when><r:when test='1 eq 3'>two</r:when><r:else>four</r:else></div>"
  res: "<div>four</div>"

case_when_test_attribute:
  src: "<r:case><r:when test='v_title'>one</r:when><r:else>two</r:else></r:case>"
  res: "one"

case_when_evil_test:
  src: "<r:case><r:when test='1 = = id'>one</r:when><r:when test='system = \"date\"'>two</r:when><r:else>three</r:else></r:case>"
  res: "three"

if_test_equal:
  src: "<r:if test='id eq 22'>one</r:if>"
  res: "one"

if_test_param:
  src: "<r:if test='param:f eq 3'>three</r:if> / <r:if test='param:f'>exist</r:if>"
  tem: "<% if params[:f].to_i == 3 -%>three<% end -%> / <% if !params[:f].blank? -%>exist<% end -%>"

if_test_param_var:
  src: "<r:set var='year'>3000</r:set><r:if test='year eq param:f'>funky!</r:if>"
  tem: "<% set_year = capture do %>3000<% end -%><% if set_year == params[:f] -%>funky!<% end -%>"

if_in_if:
  src: "<r:if test='id eq 22'><r:if test='1 eq 2'>strange...<r:else>wrong!</r:else></r:if><r:else>other node</r:else></r:if>"
  tem: "<% if @node.zip.to_i == 22 -%><% if 1 == 2 -%>strange...<% elsif true -%>wrong!<% end -%><% elsif true -%>other node<% end -%>"
  res: "wrong!"

do_if:
  src: "<b do='if' test='1 eq 2'>it's true<r:else>it's false</r:else></b>"
  res: "<b>it's false</b>"

if_has_discussion:
  src: "<r:show attr='name'/>:<r:if has='discussion'>yes<r:else>no</r:else></r:if> <r:node select='42'><r:show attr='name'/>:<r:if has='discussion'>yes<r:else>no</r:else></r:if></r:node>"
  res: "status:yes letter:no"

case_ancestor:
  src: "<r:root><r:pages><r:each join=', '><r:case><r:when node='ancestor'><b><r:show attr='name'/></b></r:when><r:else><r:show attr='name'/></r:else></r:case></r:each></r:pages></r:root>"
  res: "collections, nature, people, <b>projects</b>, skins"

on_if_ancestor_no_class:
  src: "<r:root><r:pages><li do='each' on_if_node='ancestor' join=', '><r:show attr='name'/></li></r:pages></r:root>"
  res: "<li>collections</li>, <li>nature</li>, <li>people</li>, <li class='on'>projects</li>, <li>skins</li>"

on_if_ancestor:
  src: "<r:root><r:pages><li do='each' on_if_node='ancestor' class='hello' join=', '><r:show attr='name'/></li></r:pages></r:root>"
  res: "<li class='hello'>collections</li>, <li class='hello'>nature</li>, <li class='hello'>people</li>, <li class='on'>projects</li>, <li class='hello'>skins</li>"

on_if_empty:
  src: "<li do='void' on_if='custom_a eq nil'>hello</li>"
  tem: "<li<%= @node.custom_a == nil ? \" class='on'\" : \"\" %>>hello</li>"
  res: "<li class='on'>hello</li>"

multiple_class_conditions:
  src: "<li class='unknown' do='void' one_if='custom_a eq 1' two_if='custom_a eq 2'>Agrippina</li>"
  tem: "/@node.custom_a.to_i == 2 \? \" class='two'\" : @node.custom_a.to_i == 1 \? \" class='one'\" : \" class='unknown'\" %>>Agrippina</li>|<li<%= @node.custom_a.to_i == 1 \? \" class='one'\" : @node.custom_a.to_i == 2 \? \" class='two'\" : \" class='unknown'\" %>>Agrippina</li>/"
  res: "<li class='unknown'>Agrippina</li>"

multiple_class_conditions_true_in_middle:
  src: "<li class='unknown' do='void' one_if='custom_a eq 1' two_if='2 eq 2'>Agrippina</li>"
  res: "<li class='two'>Agrippina</li>"

# var1 = stored 'papa'
test_ancestor_with_stored:
  src: "<r:parent do='parent' store='papa' do='pages'><div do='each' super_if_node='papa.ancestor' do='[name]'/></r:parent>"
  tem: "/var1.fullpath.*var3.fullpath/"
  res: "<div class='super'>cleanWater</div><div>wiki</div>"

on_if_kind_of:
  context:
    node: 'opening'
  src: "<b do='[v_title]' doc_if_kind_of='Document' popo_if_kind_of='Post'/>"
  res: "<b class='popo'>parc opening</b>"

on_if_attribute:
  context:
    node: 'cleanWater'
  src: "<r:pages><div do='each' on_if='d_assigned' do='[name]'/></r:pages>"
  tem: "/list1.each.*var1.*<div.*var1.version.dyn\[\"assigned\"\]/"
  res: "<div>crocodiles</div><div class='on'>status</div><div>track</div>"

on_if_attribute_with_edit:
  context:
    node: 'cleanWater'
  src: "<r:pages><div do='each' on_if='d_assigned'><r:show attr='name'/><r:edit/></div></r:pages>"
  tem: "/list1.each.*var1.*<div.*var1.version.dyn\[\"assigned\"\]/"

on_if_node_main:
  src: "<r:parent><r:pages><div do='each' on_if_node='main' do='[name]'>hello</div></r:pages></r:parent>"
  res: "<div>crocodiles</div><div class='on'>status</div><div>track</div>"

if_in_tag:
  src: "<r:form><p do='if' in='form' do='[name]'/></r:form><i do='if' in='form' do='[name]'/>done."
  res: "/<p>status</p></form></div>done./"

if_in_tag_else:
  src: "<r:if in='form'>in form<r:else>not in form</r:else></r:if>"
  res: "not in form"

if_or:
  src: "<r:if can='write' or_test='d_foo'>hello</r:if>"
  tem: "/<% if @node.can_write? || !@node.version.dyn[\"foo\"].blank? -%>hello<% end -%>|<% if !@node.version.dyn[\"foo\"].blank? || @node.can_write? -%>hello<% end -%>/"
  res: "hello"

if_or_same:
  src: "<r:if test='d_foo' test='d_bar'>hello</r:if>"
  tem: "/<% if !@node.version.dyn[\"foo\"].blank? || !@node.version.dyn[\"bar\"].blank? -%>hello<% end -%>|<% if !@node.version.dyn[\"bar\"].blank? || !@node.version.dyn[\"foo\"].blank? -%>hello<% end -%>/"
  res: ""

if_now:
  src: "<r:if test='log_at gt now'>future<r:else>past</r:else></r:if>"
  tem: "<% if @node.log_at.to_i > Time.now.to_i -%>future<% elsif true -%>past<% end -%>"
  res: "past"

on_if_now:
  src: "<p do='[name]' on_if='log_at gt now'/>"
  tem: "<p<%= @node.log_at.to_i > Time.now.to_i ? \" class='on'\" : \"\" %>><%= @node.name %></p>"
  res: "<p>status</p>"

visitor_is_anon:
  context:
    visitor: 'anon'
  src: "<r:if visitor='anon'>anonymous<r:else>logged in</r:else></r:if>"
  res: "anonymous"

test_in_each:
  context:
    node: 'cleanWater'
  src: "<ul do='pages'><li do='each' on_if='name eq \"track\"' do='[name]'/></ul>"
  tem: "/var1.name == \"track\"/"
  res: "<ul><li>crocodiles</li><li>status</li><li class='on'>track</li></ul>"

on_if_in_unknown:
  src: "<div do='project' on_if='name eq \"cleanWater\"' do='[name]'/>"
  res: "<div class='on'>cleanWater</div>"

test_negative_value:
  src: "<div do='void' off_if='custom_a eq -10'>...</div>"
  tem: "<div<%= @node.custom_a.to_i == -10 ? \" class='off'\" : \"\" %>>...</div>"

simple_each:
  src: "<r:children><r:each><r:show attr='name'/></r:each></r:children>"
  tem: "/.*if list1.*each.*var1.name/"
  res: ""

each_join:
  context:
    node: 'wiki'
  src: "<r:children><r:each join=', '><r:show attr='name'/></r:each></r:children>"
  res: "bird, flower"

each_join_if:
  context:
    node: 'status'
  src: "<r:pages in='site' order='name'><r:each join=', ' join_if='prev.id ne main.id and id ne main.id'><r:show attr='name'/></r:each></r:pages>"
  res: "/projects, skinsstatustalk, track/"

set_attribute:
  src: "<div class='machin' do='void' set_class='node[id]'/><r:void set_class='s[v_status]i[id]'/>"
  res: "<div class='node22'></div><div class='s50i22'></div>"

set_attribute_with_stored:
  src: "<r:parent store='child'><div do='void' set_class='[name].[child.name]'>hoho</div></r:parent>"
  res: "<div class='cleanWater.status'>hoho</div>"

set_node_param:
  src: "<p do='void' set_class='class_[main.id]'/><p do='void' set_class='[main.name]'/>"
  tem: "<p class='class_<%= @node.zip %>'></p><p class='<%= @node.name %>'></p>"
  res: "<p class='class_22'></p><p class='status'></p>"

set_node_param_main_other_class:
  src: "<r:data><p do='void' set_class='class_[main.id]'/></r:data>"
  res: "<p class='class_22'></p>"

set_attribute_with_inner:
  src: "<p set_id='node[id]' do='show' attr='name' set_class='s[v_status]'>some blah blah</p>"
  res: "<p class='s50' id='node22'>status</p>"

set_in_ztag:
  src: "<r:show attr='name' set_id='node[id]'/>"
  res: "<div id='node22'>status</div>"

set_attribute_stored_node:
  src: "<r:void store='foo'><r:parent><p do='[name]' set_id='test_[foo.id]'>hey</p></r:parent></r:void>"
  res: "<p id='test_22'>cleanWater</p>"

set_attribute_main_node:
  src: "<r:parent><p do='[name]' set_id='test_[main.name]'>hey</p></r:parent>"
  res: "<p id='test_status'>cleanWater</p>"

set_attribute_in_list:
  context:
    node: 'projects'
  src: "<div do='pages' set_id='[name]'>...</div>"
  res: "<div id='projects'>...</div>"

set_attribute_with_namespace:
  src: "<entry do='void' set_xml:base='[name]'>..</entry>"
  res: "<entry xml:base='status'>..</entry>"

each_join_html:
  context:
    node: 'wiki'
  src: "<r:children><r:each join='&lt;br/&gt;'><r:show attr='name'/></r:each></r:children>"
  res: "bird<br/>flower"

each_join_nasty_erb:
  context:
    node: 'wiki'
  src: "<r:children><r:each join='&lt;% puts \'nasty\' -%&gt;'><r:show attr='name'/></r:each></r:children>"
  res: "bird&lt;% puts 'nasty' -%&gt;flower"

img_no_image:
  src: "<r:img/>"
  tem: "<%= img_tag(@node, :mode=>\"std\") %>"
  res: "<img src='/images/ext/page.png' width='32' height='32' alt='Page node' class='node'/>"

img_tag_icon:
  context:
    node: 'cleanWater'
  src: "<r:img alt_src='icon'/>"
  res: "<img src='/en/projects/cleanWater/image24_std.jpg?929831698949' width='545' height='400' alt='it&apos;s a lake' class='std'/>"

icon:
  context:
    node: 'cleanWater'
  src: "<r:icon do='[name]'/>"
  res: "lake"

img_image:
  context:
    node: 'bird_jpg'
  src: "<r:img/><r:img mode='med'/>"
  res: "/<img src='/en/image30_std.jpg\?929831698949' width='440' height='400' alt='bird' class='std'/><img src='/en/image30_med.jpg\?390663777446' width='220' height='200' alt='bird' id='.*' class='med' onclick='Zena.popup\(this\)'/>/"

img_image_not_public:
  context:
    visitor: 'ant'
    node: 'tree_jpg'
  src: "<r:img/><r:img mode='med'/>"
  res: "/<img src='/oo/image40_std.jpg\?929831698949' width='600' height='399' alt='Autumn Tree' class='std'/><img src='/oo/image40_med.jpg\?390663777446' width='300' height='200' alt='Autumn Tree' id='.*' class='med' onclick='Zena.popup\(this\)'/>/"

img_href:
  context:
    node: 'bird_jpg'
  src: "<r:img link='self'/>"
  res: "<a href='/oo/image30.html'><img src='/en/image30_std.jpg?929831698949' width='440' height='400' alt='bird' class='std'/></a>"

img_src_id:
  src: "<r:img src='30'/>"
  res: "<img src='/en/image30_std.jpg?929831698949' width='440' height='400' alt='bird' class='std'/>"

img_src_mode:
  src: "<r:img src='30' mode='pv'/>"
  res: "<img src='/en/image30_pv.jpg?967816914293' width='70' height='70' alt='bird' class='pv'/>"

img_html_params:
  src: "<r:img src='30' id='super'/>"
  res: "<img src='/en/image30_std.jpg?929831698949' width='440' height='400' alt='bird' id='super' class='std'/>"

test_children_plural:
  tem: "<%= 'children'.pluralize %>"
  res: "children"

each_do:
  context:
    node: 'wiki'
  src: "<r:children><r:each join=', ' do='show' attr='name'/></r:children>"
  res: "bird, flower"

parent_do:
  context:
    node: 'wiki'
  src: "<r:parent do='link'/>"
  res: "<a href='/oo/page18.html'>projects list</a>"

do_each:
  context:
    node: 'wiki'
  src: "<r:children do='each'><r:link/></r:children>"
  res: "<a href='/oo/image30.html'>bird</a><a href='/oo/image31.html'>flower</a>"

do_with_inner:
  context:
    node: 'wiki'
  src: "<ul do='children' do='each' tag='li'><r:show attr='name'/></ul>"
  res: "<ul><li>bird</li><li>flower</li></ul>"

do_each_do:
  context:
    node: 'wiki'
  src: "<ul do='children' do='each' tag='li' do='link'/>"
  res: "<ul><li><a href='/oo/image30.html'>bird</a></li><li><a href='/oo/image31.html'>flower</a></li></ul>"

ignore:
  src: "<r:ignore>I think this is not</r:ignore>cool!"
  res: "cool!"

do_ignore:
  context:
    node: 'wiki'
  src: "<ul do='ignore' do='children' do='each' tag='li'><r:link/></ul>"
  res: ""

name_title:
  src: "title: <h1 id='lala' do='show' name='title' attr='name'>blah</h1>"
  res: "title: <h1 id='lala'>status</h1>"

include_with:
  src: "include_with: <r:include template='/name/title'><h1 do='with' part='title' attr='id'/>"
  res: "include_with: title: <h1 id='lala'>22</h1>"

id_name:
  src: "name_with_name: My name is <b do='void' name='bob'>Bob</b>.<r:void id='comment'> I am happy.</r:void>"
  res: "name_with_name: My name is <b>Bob</b>. I am happy."

include_named:
  src: "include_named: <r:include template='/id/name'><r:with part='bob'>John</r:with></r:include>"
  res: "include_named: name_with_name: My name is <b>John</b>. I am happy."

# this test is a dummy used by include_context
context_dummy:
  src: "CD: <r:pages in='site' where='name like \"s%\"' name='pages'><r:each join=', ' do='[name]'/></r:pages>"
  res: "CD: skins, status"

include_context:
  src: "IC: <r:include template='/context/dummy'><r:with part='pages'><r:each join=' / ' do='[name]'/></r:with></r:include>"
  res: "IC: CD: skins / status"

content_for_layout:
  src: "<r:content_for_layout>blah blah</r:content_for_layout>"
  tem: "<% if content_for_layout = yield -%><%= content_for_layout %><% else -%>blah blah<% end -%>"
  res: "blah blah"

title_for_layout:
  src: "<r:title_for_layout>blah blih</r:title_for_layout>"
  res: "zena/projects/cleanWater/status"

tada:
  context:
    node: 'opening'
  src: |
    <h1 id='main_title' do='show' attr='v_title'>Super project</h1>

    <ul do='set_tags'>
      <li do='each' do='link'>sample tag</li>
      <li do='ignore'>life</li>
      <li do='ignore'>ruby</li>
    </ul>

    <div id='text' do='zazen' attr='v_text'>
      <p>Lorem ipsum dolor sit amet, consectetuer elit....</p>
      <h3>some title</h3>
    </div>
  res: |
    <h1 id='main_title'>parc opening</h1>

    <ul>
      <li><a href='/oo/tag33.html'>Art</a></li>
      <li><a href='/oo/tag34.html'>News list</a></li>
    </ul>

    <div class='zazen' id='text'><p>We are glad to announce the opening of our new project !</p>


    	<p>You are all invited to <strong>Romanel</strong> for a great party this weekend.</p></div>

summary:
  context:
    node: 'zena'
  src: "<r:summary/>"
  res: "<div class='zazen' id='v_summary11'></div>"

summary_exists:
  src: "<r:summary/>"
  res: "<div class='zazen' id='v_summary22'><p>status summary</p></div>"

empty_summary:
  src: "<r:summary text=''/>"
  res: "<div class='zazen' id='v_summary22'></div>"

summary_or_text_has_summary:
  src: "<td do='summary' or='v_text'/>"
  res: "<td class='zazen' id='v_summary22'><p>status summary</p></td>"

summary_or_text_no_summary:
  context:
    node: 'zena'
  src: "<r:summary or='v_text'/>"
  res: "<div class='zazen' id='v_summary11'><p>This is the root of your peaceful tests.</p></div>"

summary_in_div_with_id:
  src: "<div id='foo' do='summary'/>"
  res: "<div class='zazen' id='foo'><div id='v_summary22'><p>status summary</p></div></div>"

text:
  src: "<r:text/>"
  res: "<div class='zazen' id='v_text22'><p>status text</p></div>"

text_code:
  context:
    node: 'Project_zafu'
  src: "<td do='text'/>"
  res: "/\\A<td class='zazen' id='v_text61'><pre class='full'><code class='zafu'>.*</code></pre></td>\\Z/"

ztag_in_do:
  src: "<ol do='parent'><r:children>no error</r:children></ol>"
  res: "<ol>no error</ol>"

design_by:
  src: "<li do='design' skin='hop'><a href='http://teti.ch'>teti.ch</a></li>"
  res: "<li><i>hop</i>, design by <a href='http://teti.ch'>teti.ch</a></li>"

design_by_options:
  src: "<li do='design' skin='dark' by='vador' href='http://teti.ch'></li>"
  res: "<li><i>dark</i>, design by <a href='http://teti.ch'>vador</a></li>"

select_class_existing_node:
  context:
    node: 'letter'
  src: "<r:form><select name='klass' root_class='Note' selected='Post'/></r:form>"
  res: "/<select name=.node\[klass\].><option value=\"Note\">Note<\/option>\n<option value=\"Letter\" selected=\"selected\">  Letter<\/option>\n<option value=\"Post\">  Post<\/option><\/select>/"

select_class_new_node:
  src: "<r:pages><r:each/><r:add/><r:form><select name='klass' root_class='Note' selected='Post'/></r:form>"
  res: "/<select.*name=.node\[klass\].*Note.*Letter.*Post. selected=.selected./"

select_nodes:
  src: "<r:form><select nodes='images in site' name='d_ref'></select></r:form>"
  res: "/name='node\[d_ref\]'><option value=\"\" selected=\"selected\"></option>\n<option value=\"30\">bird</option>\n<option value=\"31\">flower</option>/"

do_not_set_parent_id_if_form_contains_parent_id:
  src: "<r:children><r:each do='[name]'/><r:add/><r:form><r:select name='parent_id' nodes='projects in site'/><input name='v_title'/></r:form></r:children>"
  res: "!/node\[parent_id\].\s+value/"

select_nodes_selected:
  src: "<r:form><select name='parent_id' nodes='projects in site'/></r:form>"
  res: "/option\s* value=.21.\s* selected=.selected.>cleanWater/"

select_nodes_in_ajax:
  src: "<r:pages><r:each do='[name]'/><r:add/><r:form><r:select nodes='images in site' name='d_ref'/></r:form></r:pages>"
  res: "/name=.node\[d_ref\].><option value=\"\" selected=\"selected\"></option>\n<option value=\"30\">bird</option>\n<option value=\"31\">flower</option>/"

select_nodes_show_attr:
  src: "<r:form><r:select name='d_ref' nodes='images in site' attr='c_ext' show='v_title'/></r:form>"
  res: "/name=.node\[d_ref\].>.*<option value=\"jpg\">flower</option>\n<option value=\"jpg\">it's a lake</option>/"

select_nodes_data_list:
  context:
    node: status
  src: "<r:data><r:each><r:form><select nodes='projects in site' name='node_a_id'/></r:form></r:each></r:data>"
  res: "/option\s* value=.29.\s* selected=.selected.>wiki/"

select_time_zone:
  src: "<r:form><r:select type='time_zone' name='d_tz'/></r:form>"
  res: "/Asia/Jakarta.*Europe/Zurich.*US/Hawai"

select_values_tshow:
  src: "<r:select name='d_foo' values='1,2,3' tshow='en,fr,de'/>"
  res: "/option value=.1.>english.*option value=.2.>french/"

form_publish:
  src: "<r:form publish='true'><r:select name='d_foo' values='bar,baz'/></r:form>"
  res: "/div.*name=.node\[v_status\]. value=.50.\/>.*<\/div>/"

checkbox:
  context:
    node: 'opening'
  src: "<r:checkbox role='calendar' values='11'/>"
  res: "/input type='checkbox' name='node\[calendar_ids\]\[\]' value='11' checked='checked'.*zena.*hidden.*node\[calendar_ids\]\[\]' value=''/"

checkbox_finder:
  context:
    node: 'opening'
  src: "<r:checkbox role='calendar' values='projects in site'/>"
  res: "/value=.21.*cleanWater.*input type=.checkbox. name=.node\[calendar_ids\]\[\]. value=.29. checked=.checked.*wiki/"

checkbox_checked_value:
  src: "<r:input type='checkbox' name='tagged[sky]'/>"
  res: "<input name='node[tagged][sky]' type='checkbox' value='sky' checked='checked'/>"

checkbox_unchecked_value:
  src: "<r:input type='checkbox' name='tagged[foo]'/>"
  tem: "/@node.tagged\\[\"foo\"\\] == \"foo\"/"

input_set_value:
  src: "<r:input type='hidden' name='icon_id' set_value='[main.id]'/>"
  tem: "<input name='node[icon_id]' type='hidden' value='<%= @node.zip %>'/>"
  res: "<input name='node[icon_id]' type='hidden' value='22'/>"

input:
  context:
    node: 'ant'
  src: "<r:input name='c_first_name'/>"
  tem: "<input name='node[c_first_name]' type='text' value='<%= fquote @node.version.safe_content_read(\"first_name\") %>'/>"
  res: "<input name='node[c_first_name]' type='text' value='Solenopsis'/>"

input_style:
  src: "<r:input style='display:none;' type='submit'/>"
  res: "<input style='display:none;' type='submit'/>"

textarea:
  context:
    node: 'ant'
  src: "<r:textarea name='c_first_name'/>"
  tem: "<textarea name='node[c_first_name]'><%= @node.version.safe_content_read(\"first_name\") %></textarea>"
  res: "<textarea name='node[c_first_name]'>Solenopsis</textarea>"

textarea_with_blocks:
  context:
    node: 'ant'
  src: "<r:textarea name='c_first_name'>Sir <r:show attr='c_first_name'/></textarea>"
  tem: "<textarea name='node[c_first_name]'>Sir <%= @node.version.safe_content_read(\"first_name\") %></textarea></textarea>"
  res: "<textarea name='node[c_first_name]'>Sir Solenopsis</textarea></textarea>"

input_new:
  context:
    node: 'ant'
  src: "<r:contacts><r:each/><r:form><r:input name='c_first_name'/></r:form><r:add/></r:contacts>"
  res: "!/value=''''/"

add_btn:
  src: "<table do='pages' in='site' limit='1'>
  <tr do='each'><td do='[name]'/></tr>
  <tr do='add'><td><b><r:add_btn/></b></td></tr>
  </table>"
  res: "/<tr class='btn_add' id='list1_add'><td><b><a href='#' onclick/"

read_no_content:
  src: "this is <b do='[c_bad]'/>"
  res: "this is <b></b>"

read_bad_attribute:
  src: "this is <b do='[bad]'/>"
  res: "this is <b>'bad' not readable</b>"

translate_id_to_zip:
  src: "<b do='[d_empid]'/><i do='[parent_id]'/>"
  tem: "<b><%= @node.version.dyn[\"empid\"] %></b><i><%= @node.parent_zip %></i>"

date:
  context:
    visitor: ant
    node: 'letter'
    lang: 'fr'
  src: "<r:date select='[log_at]'>nouvelles de <r:trans do='[current_date]' format='%B'/> <r:show date='current_date' format='%Y'/>: <r:notes in='site' log='month' do='each' join=', ' do='[name]'/></r:date>"
  res: "nouvelles de avril 2006: letter"

add_document:
  src: "<r:add_document/>"
  res: "/<a href='/documents/new\?parent_id=22' onclick='uploader=window.open\(\"/documents/new\?parent_id=22.*images/picture_add.png/"

cannot_add_document:
  context:
    visitor: 'anon'
  src: "__<r:add_document/>__"
  res: "____"

recursion:
  src: "<r:void name='grp'><r:show attr='name'/><r:parent> -- <r:include part='grp'/></r:parent></r:void>"
  res: "status -- cleanWater -- projects -- zena"

recursion_in_each:
  src: "<ul do='comments'>
    <li do='each' name='com'><b do='[title]'>sample title</b>
      <ul do='replies' do='include' part='com'/>
    </li>
  </ul>"
  res: "<ul> <li><b>I agree</b> </li> <li><b>I think this is bad</b> <ul> <li><b>Why ?</b> </li></ul> </li> <li><b>OK for me</b> </li> </ul>"

#comments_with_params:
#  src: "<r:comments order='date desc'><r:each join=', ' do='[title]'/></r:comments>"
#  tem: "."

comments_shown_if_empty_but_can_comment:
  src: "<r:comments><r:each do='[title]'/><r:add/></r:comments>"
  tem: "/if \(list1 = @node.comments\) \|\| \(@node.can_comment\? && list1=\[\]\) -%>/"

date_tformat:
  context:
    node: 'people'
    lang: 'fr'
  src: "<r:show date='created_at' tformat='%d %B %Y'/>"
  tem: "<%= format_date(@node.created_at, \"%d %B %Y\") %>"
  res: "10 mars 2006"

date_tz:
  context:
    visitor: 'ant'
    node: 'people'
    lang: 'en'
  src: "<r:show date='created_at' format='%H:%M'/> / <r:show date='created_at' format='%H:%M' time_zone='Asia/Jakarta'/>"
  res: "01:00 / 07:00"

date_tz_field:
  context:
    node: 'projects'
  src: "<r:pages do='each' join=', '><r:show attr='name'/>: <r:show date='created_at' format='%H:%M' time_zone='[d_tz]' time_zone='Europe/Zurich'/> | <r:show date='created_at' format='%H:%M' time_zone='UTC'/></r:pages>"
  res: "cleanWater: 07:00 | 00:00, wiki: 01:00 | 00:00"

dictionary_fr:
  context:
    lang: 'fr'
  src: "<r:load dictionary='translations'><r:trans>foo</r:trans>: <r:t>I love</r:t> <r:trans>words</r:trans></r:load>"
  tem: "foo: j'aime les mots"
  res: "foo: j'aime les mots"

dictionary_de:
  context:
    lang: 'de'
  src: "<r:load dictionary='translations'><r:trans>foo</r:trans>: <r:trans>I love</r:trans> <r:trans>words</r:trans></r:load>"
  tem: "foo: Ich liebe Wörter"
  res: "foo: Ich liebe Wörter"

dictionary_tformat:
  src: "<r:load dictionary='translations'><r:show date='created_at' tformat='date_format'/></r:load>"
  res: "[10.03]"

captcha:
  context:
    visitor: anon
    lang: 'fr'
  src: "<r:captcha theme='clean'/>"
  res: "/RecaptchaOptions .* theme : .clean./"

date_fr:
  context:
    visitor: ant
    lang: 'fr'
  src: "<r:show date='created_at' format='%a'/>"
  res: "Ven"

date_fr_lang:
  context:
    lang: 'fr'
  src: "<r:show date='created_at' format='%a' lang='en'/>"
  res: "Fri"

date_context:
  src: "<r:date select='2008-03-02'><r:show date='current_date' format='%A %d.%m.%Y'/></r:date>"
  tem: "<%= format_date(\"2008-03-02\", \"%A %d.%m.%Y\") %>"
  res: "Sunday 02.03.2008"

date_from_params:
  context:
    year: 1975
  src: "<r:date select='[param:year]-01-01'><r:show date='current_date' format='%A %d.%m.%Y'/></r:date>"
  tem: "<%= format_date(\"#{params[:year]}-01-01\", \"%A %d.%m.%Y\") %>"
  res: "Wednesday 01.01.1975"

date_from_params_in_query:
  context:
    year: 2006
  src: "<r:date select='[param:year]-01-01'><r:nodes in='site' log='year' do='each' join=', ' do='[name]'/></r:date>"
  tem: "/(date_format|strftime).*format_date.*params\[:year\].*%Y/"
  res: "letter, opening"

paginate:
  context:
    pak: 2
  src: "<r:nodes in='site' limit='3' order='zip' paginate='pak' do='each' join=',' do='[id]'/>"
  res: "14,15,16"

find_count:
  src: "<r:nodes in='site' where='name like \"a%\"' find='count'/>"
  res: "3"

link_page_next:
  context:
    pak: 2
  src: "<r:nodes in='site' limit='3' order='zip' paginate='pak'><r:link page='previous'/> | <r:show var='pak'/> | <r:link page='next'/> || <r:each join=',' do='[name]'/></r:nodes>"
  res: "<a href='/oo/projects/cleanWater/page22.html?pak=1'>1</a> | 2 | <a href='/oo/projects/cleanWater/page22.html?pak=3'>3</a> || tiger,lion,myLife"

link_page_next_with_block:
  src: "<r:nodes in='site' limit='3' order='zip' paginate='pak'><r:link page='next' do='t'>next</r:link></r:nodes>"
  res: "<a href='/oo/projects/cleanWater/page22.html?pak=2'>next</a>"

link_page_list:
  context:
    pak: 2
  src: "<r:nodes in='site' limit='10' order='zip' paginate='pak' do='link' page='list' join=', '/>"
  tem: "/set_pak_page != set_pak.*zen_path\(@node,:pak.*elsif true.*set_pak_page/"
  res: "/<a href='.*page22.html\?pak=1'>1</a>, 2, .*pak=3'>3</a>.*pak=4'>4</a>.*pak=5'>5</a>/"

# TODO:
#link_page_list_single_page:
#  src: "<r:images in='site' limit='10' order='zip' paginate='p' do='link' page='list' join=', '/>"
#  res: "" # should not show single page

link_page_list_page_count:
  context:
    pak: 3
  src: "<r:nodes in='site' limit='10' order='zip' paginate='pak' do='link' page='list' join=', ' page_count='3'/>"
  res: "/<a href='.*page22.html\?pak=2'>2</a>, 3, .*pak=4'>4</a>\\Z/"

paginate_with_or_clause:
  context:
    pak: 2
  src: "<div do='pages' in='site' or='images in site' limit='10' order='zip' paginate='pak'><r:show var='pak_count'/> pages (<r:show var='pak_nodes'/> nodes)</div>"
  res: "<div>3 pages (22 nodes)</div>"

paginate_with_where_clause:
  context:
    pak: 2
  src: "<div do='pages' in='site' where='v_title like \"%[param:k]%\"'><r:stat find='count'/> nodes</div> // <div do='pages' in='site' where='v_title like \"%[param:k]%\"' limit='10' order='zip' paginate='pak'><r:show var='pak_count'/> pages (<r:show var='pak_nodes'/> nodes)</div>"
  res: "<div>18 nodes</div> // <div>2 pages (18 nodes)</div>"

paginate_with_group_clause:
  context:
    pak: 2
  src: "<div do='nodes' in='site' group='log_at:year'><r:stat find='count'/> nodes</div> // <div do='nodes' in='site' group='log_at:year' limit='2' paginate='pak'><r:show var='pak_count'/> pages (<r:show var='pak_nodes'/> nodes)</div>"
  res: "<div>3 nodes</div> // <div>2 pages (3 nodes)</div>"

link_page_previous_else_page1:
  src: "<r:nodes in='site' limit='3' order='zip' paginate='pak'><r:link page='previous' do='else'>noprev</r:link></r:nodes>"
  res: "noprev"

link_page_previous_else_page2:
  context:
    pak: 2
  src: "<r:nodes in='site' limit='3' order='zip' paginate='pak'><r:link page='previous' do='else'>noprev</r:link></r:nodes>"
  res: "<a href='/oo/projects/cleanWater/page22.html?pak=1'>1</a>"

link_page_list_else:
  context:
    pak: 2
  src: "<r:nodes in='site' limit='3' order='zip' paginate='pak'><r:link page='list' join=', ' do='else'>[<r:show var='pak'/>]</r:link></r:nodes>"
  res: "/<a.*1</a>, [2], <a.*3</a>/"

debug_params:
  context:
    foo: 'bar'
    dev: true
  src: "DEBUG: <r:debug title='no idea for a title' show='params'/><r:debug do='[name]'/>"
  tem: "DEBUG: <div class='debug'><p>no idea for a title</p><pre><%= params.inspect %></pre></div><div class='debug'><%= @node.name %></div>"
  res: "/DEBUG: <div class='debug'><p>no idea for a title</p><pre>.*\"foo\"=>\"bar\".*</pre></div><div class='debug'>status</div>/"

debug_params_not_in_dev_mode:
  context:
    foo: 'bar'
  src: "DEBUG: <r:debug show='params'/><r:debug do='[name]'/><r:debug title='help needed'/>"
  tem: 'DEBUG: '
  res: 'DEBUG: '

expand_with_host:
  context:
    node: 'projects'
  src: "relative:<r:link/> absolute:<r:expand_with host='bob.com' do='link'/>"
  tem: "/relative:.*zen_path\(@node\).*absolute:.*zen_path\(@node, :host => \"bob.com\"\)/"
  res: "relative:<a href='/oo/page18.html'>projects list</a> absolute:<a href='http://bob.com/oo/page18.html'>projects list</a>"

expand_with_set_host:
  context:
    node: 'projects'
  src: "relative:<r:link/> absolute:<r:expand_with set_host='[site.host]' do='link'/>"
  tem: "/relative:.*zen_path\(@node\).*absolute:.*zen_path\(@node, :host => \"#\{current_site.host\}\"/"
  res: "relative:<a href='/oo/page18.html'>projects list</a> absolute:<a href='http://test.host/oo/page18.html'>projects list</a>"